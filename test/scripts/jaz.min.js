/*! Jaz v1.1.0
 // alpha version 1.0   
 // MIT Licensed http://opensource.org/licenses/MIT
 */

"use strict";function renderExternalScript(e){var t=!1;try{var r=document.createElement("script");r.type="text/javascript",r.src=e,document.querySelector("head").appendChild(r),t=!0}catch(n){throw new Error("External JavaScript file failed to load properly.")}return t}const Status={inProcess:!1},Scope=function(e){if("string"!=typeof e)throw new Error("Scope objects must be constructed with a string.");if(this._scope=void 0,"*"===e)return void(this._scope="a");const t=/(^(\.|#)[a-zA-Z](\w+)?)/g,r=/(data-[a-zA-Z](\w+)?)/g;if(e.match(t)){if(!document.querySelector("a"+e))throw new Error("Scope identifier was not found in the scope of the web page: "+e+"\nCheck to see you're attempting to reference the correct element.");this._scope="a"+e}else{if(!e.match(r))throw new Error("Scope string is invalid: "+e+"\nYou must define the scope with either a reference to a class, ID, or data-* attribute name.");if(!document.querySelector("a["+e+"]"))throw new Error("Scope identifier was not found in the scope of the web page: "+e+"\nCheck to see you're attempting to reference the correct element.");this._scope="a["+e+"]"}};Scope.prototype.identifier=function(){return this._scope};const Target=function(e){if("string"!=typeof e)throw new Error("Target objects must be constructed with a string.");this._target=void 0;const t=/(^(\.|#)?[a-zA-Z](\w+)?)/g;if(!e.match(t))throw new Error("Target string is invalid: "+e+"\nYou must define the target with either a reference to a class, ID, or tag name.");if(!document.querySelector(e))throw new Error("Target identifier was not found in the scope of the web page: "+e+"\nCheck to see you're attempting to reference the correct element.");this._target=e};Target.prototype.identifier=function(){if("undefined"==typeof this._target||!this._target)throw new Error("Attempted to access an invalid target value from a Target object.\nMake sure the Target object was constructed correctly.");return this._target};const Intermission=function(e){if("undefined"==typeof e||!e)return console.warn("Intermission object is undefined; assumed no Intermission is requested."),this.loading=null,void(this.callback=null);if("object"!=typeof e)throw new Error("Intermission objects must be constructed with an basic object containing the loading function and a callback function.");const t=e.loading,r=e.callback;if("function"!=typeof r||"function"!=typeof t)throw new Error("Error when defining intermission and callback.\nMake sure they are both defined as valid functions.");this.loading=t,this.callback=r};Intermission.prototype.fire=function(e,t){if("function"==typeof this.loading&&this.loading){var r=new Promise(function(e,r){try{this.loading(),setTimeout(function(){e(console.log("Intermission loading fired correctly."))},t)}catch(n){r(new Error("Intermission loading function was recjected.\nPerhaps the loading function given itself throws an error; check your loading function.\nError: "+n.getMessage))}}.bind(this));r.then(e)}else e()},Intermission.prototype.done=function(){"function"==typeof this.callback&&this.callback&&this.callback()};const Jaz=function(){this.status=Status,this.scope=void 0,this.intermission=void 0,this.delay=0,this.targetArea=void 0};Jaz.prototype.config=function(e){var t,r,n;if("object"!=typeof e||!e)throw new Error("Configuration settings must be an object.");try{t=e.scope,r=e.intermission,n=e.targetArea}catch(i){throw new Error("Configuration object must be constructed with a string, and an object of functions: "+i.message)}"number"==typeof e.delay&&e.delay&&(this.delay=e.delay),this.scope=new Scope(t),this.intermission=new Intermission(r),this.targetArea=new Target(n)},Jaz.prototype.remoteBlockRouting=function(){if("object"!=typeof this.scope||!this.scope)throw new Error("Error: undefined or invalid scope.");for(var e=[],t=0;t<document.querySelectorAll(this.scope.identifier()).length;t++)e.push(document.querySelectorAll(this.scope.identifier())[t]);e.map(function(e){var t=e.href;e.addEventListener("click",function(e){this.reconfigureRouting(e,t)}.bind(this))}.bind(this))},Jaz.prototype.reconfigureRouting=function(e,t){return e.preventDefault(),this.status.inProcess?void console.warn("Process is already active; all subsequent actions invoked while this process is running will be ignored."):(this.status.inProcess=!0,void this.intermission.fire(function(){this.continueProcess(e,t)}.bind(this),this.delay))},Jaz.prototype.continueProcess=function(e,t){window.history.pushState({},"",t);var r;console.log("Route path: "+t),r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),r.open("GET",t,!0),r.onreadystatechange=function(){if(r.readyState==XMLHttpRequest.DONE){if(200!=r.status)throw window.location=t,new Error("AJAX load failed: invalid status returned: "+r.status);this.parseHTML(r.responseText)}}.bind(this);try{r.send()}catch(e){console.warn("Error: Connection refused.\nFall back initiated."),window.location=t}},Jaz.prototype.listen=function(){console.warn("Jaz is listening..."),window.Jaz_Reference=this,this.remoteBlockRouting()},Jaz.prototype.parseHTML=function(rawHTML){const DOM=document.createElement("html");DOM.innerHTML=rawHTML;const renderedData=DOM.querySelector(this.targetArea.identifier());document.querySelector(this.targetArea.identifier()).innerHTML=renderedData.innerHTML;for(var renderedInternalScripts=[],renderedExternalScripts=[],i=0;i<document.querySelectorAll(this.targetArea.identifier()+" script").length;i++)document.querySelectorAll(this.targetArea.identifier()+" script")[i].src?renderedExternalScripts.push(document.querySelectorAll(this.targetArea.identifier()+" script")[i]):renderedInternalScripts.push(document.querySelectorAll(this.targetArea.identifier()+" script")[i]);var allPromises=[];renderedInternalScripts.map(function(script){allPromises.push(new Promise(function(fulfill,reject){var passed=!1;try{eval(script.innerHTML),passed=!0}catch(e){throw new Error("Failure to render internal script: "+e.getMessage)}passed?fulfill(console.log("Internal script fulfilled.")):reject(new Error("Internal script tag failed to render correctly."))}))}),renderedExternalScripts.map(function(e){allPromises.push(new Promise(function(t,r){renderExternalScript(e.src)?t(console.log("External script fulfilled.")):r(new Error("External script tag failed to render correctly."))}))}),Promise.all(allPromises).then(function(){console.log("Fulfilled all promises."),this.completeProcess()}.bind(this),function(){throw new Error("Some error occurred while attemping to render scripts.")})},Jaz.prototype.completeProcess=function(){this.intermission.done(),this.remoteBlockRouting(),this.status.inProcess=!1},window.onpopstate=function(e){if("object"==typeof window.Jaz_Reference&&window.Jaz_Reference&&e.state){var t=window.location.href||document.URL;Jaz_Reference.reconfigureRouting(e,t)}},window.Jaz=Jaz;